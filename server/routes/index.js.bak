const express = require('express');
const router = express.Router();

const MongoClient = require('mongodb').MongoClient;
const assert = require('assert');

const iconv = require('iconv-lite');
const request = require('request');
const cheerio = require('cheerio');
const config = require('../config');

var data = {};

router.get('/', function(req, res, next) {
    var requestContent = {
	encoding: null,
	method: 'GET',
	uri: 'http://www.societe.com/societe/'+'AUCHAN' + '-' + '410409460' + '.html'
    };
    
    request(requestContent, function(error, response, html){
	if(!error){
	    var $ = cheerio.load(iconv.decode(new Buffer(html), 'ISO-8859-1'));

	    var pag = [];
	    var pag2 = [];

	    links = $("#rensjur td");
	    $(links).each(function(i, link){
		var title = $(this).text();
		pag[i] = title;
	    });
	    links = $("#rensjurcomplete td");
	    $(links).each(function(i, link){
		var title2 = $(this).text();
		pag2[i] = title2;
	    });
	    
	    /*
	    $("#rensjur td").each((i) => {
		let buffer = $(this).text();
		data.table1[i] = buffer;
	    });

	    $("#rensjurcomplete td").each((i) => {
		let buffer = $(this).text();
		data.table2[i] = buffer;
	    });
*/
	}
    })
    console.log(pag);
    console.log(pag2);
    res.setHeader('Content-Type', 'application/json');
});

module.exports = router;
